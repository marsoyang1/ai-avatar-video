---
name: ai-avatar-video
description: AI 数字人视频生成完整工作流。包含文案生成、语音合成、视频渲染及合并。每一步执行前都会使用交互式问题收集必要信息，支持用户确认、修改或提供自定义参数。
---

# AI Avatar Video 制作技能

## 快速开始

"帮我制作一个关于[主题]的数字人视频，发布在[平台]上。"

## 核心工作流

本技能执行以下步骤，**每一步执行前都会通过交互式问题收集信息并请求确认**：

0. **初始化任务** (自动生成唯一任务ID)
1. **基础信息收集** → 2. **文案生成** → 3. **语音合成** → 4. **视频生成** → 5. **视频合并**

## 步骤详解

### Step 0: 初始化任务

**操作：**
- 生成一个唯一的任务 ID，例如：`task_20240101_120000` (使用当前时间戳)。
- **注意：** 所有生成的资源文件必须保存在当前工作目录下的 `out/` 目录中，并使用此任务 ID 进行隔离。

### Step 1: 基础信息收集

**必须收集的信息：**
- 视频主题是什么？
- 发布平台是哪个？
- 是否需要自定义参数？

**使用 question 工具收集：**
```markdown
## 🎯 基础信息收集

**请提供以下信息：**

1. **视频主题**（必填）
   - 例如：AI 的未来、健康饮食建议、科技趋势
   - 请输入：_________

2. **发布平台**（必填）
   - [A] 抖音/短视频
   - [B] 视频号
   - [C] 小红书
   - [D] B站
   - [E] YouTube
   - [F] 其他平台

3. **高级选项**（可选）
   - 是否需要自定义文案风格？
   - 是否需要自定义视频比例？
   - 是否使用默认的音频和形象？

**确认后继续：**
- ✅ 信息正确，开始生成文案
- ❌ 重新填写
```

### Step 2: 文案生成

**执行前确认：**
```markdown
## 📝 文案生成确认

**基于以下信息生成文案：**
- 主题：[用户输入的主题]
- 平台：[用户选择的平台]
- 风格：[默认/自定义]

**生成选项：**
- ✅ 生成新文案
- 📝 手动输入已有文案
- ❌ 返回修改

**文案生成后，收集确认：**
- ✅ 文案满意，继续语音合成
- 🔄 重新生成文案
- ✏️ 手动修改文案
- 📋 复制文案内容
```

### Step 3: 语音合成

**执行前收集：**
```markdown
## 🎵 语音合成设置

**请提供以下信息：**

1. **参考音频文件路径**（可选）
   - 默认：`./assets/reference_audio/yb.wav`
   - 自定义路径：_________
   - 📂 浏览可用音频

2. **情绪参考音频路径**（可选）
   - 默认：`./assets/emotion_reference_audio/speed.wav`
   - 自定义路径：_________
   - 📂 浏览可用音频

3. **API 配置**（必填）
   - Index-TTS 语音合成接口 BaseURL：_________

**高级选项：**
- 语速调节：[慢速] [正常] [快速]
- 音量调节：[低] [正常] [高]

**确认后继续：**
- ✅ 使用当前设置，开始生成语音
- ❌ 返回修改
```

**生成后收集：**
```markdown
## ✅ 语音合成完成

**生成的音频文件：**
[列出所有 mp3 文件]

**状态：** ✅ 成功 / ⚠️ 部分失败 / ❌ 失败

**选项：**
- ✅ 满意，继续生成视频
- 🔄 重新生成语音
- 📂 预览音频
- ❌ 取消任务
```

### Step 4: 视频生成

**执行前收集：**
```markdown
## 🎬 视频生成设置

**请提供以下信息：**

1. **参考人物照片路径**（可选）
   - 默认：`./assets/reference_person/yb.jpg`
   - 自定义路径：_________
   - 📂 浏览可用照片

2. **视频比例**（必选）
   - [A] 9:16（抖音/短视频）✅ 推荐
   - [B] 16:9（横屏视频）
   - [C] 1:1（正方形）
   - [D] 4:3（传统比例）
   - [E] 其他比例

3. **API 配置**（必填）
   - 数字人视频生成接口 BaseURL：_________

**预览选项：**
- 👁️ 预览参考人物照片
- 📐 查看各比例效果示意

**确认后继续：**
- ✅ 确认设置，开始生成视频
- ❌ 返回修改
```

**生成过程中收集：**
```markdown
## 🎥 视频生成进度

**当前处理：** [音频文件名] → [对应的视频文件]

**进度：** [已完成]/[总数]

**已生成的视频片段：**
- 1.mp4 ✅
- 2.mp4 ⏳ 生成中...
- 3.mp4 ⏸️ 等待中

**选项：**
- ⏸️ 暂停生成
- ❌ 取消任务
- ✅ 继续
```

**生成完成后收集：**
```markdown
## ✅ 视频片段生成完成

**所有视频片段：**
[列出所有 *.mp4 文件]

**总时长：** [计算的总时长]

**选项：**
- ✅ 合并视频片段
- 🔄 重新生成某个片段
- 📂 预览视频片段
- ❌ 取消
```

### Step 5: 视频合并

**执行前收集：**
```markdown
## 🎬 最终视频设置

**输入片段：** [列出所有待合并的视频文件]

**输出设置：**
1. **最终文件名**（必填）
   - 默认：[任务ID]_[主题].mp4
   - 自定义：_________

2. **输出路径**（可选）
   - 默认：`./out/video/`
   - 自定义：_________

3. **片段顺序**（可选）
   - [A] 保持默认顺序
   - [B] 调整片段顺序

**预览选项：**
- 📊 显示片段顺序和时间线
- ▶️ 预览第一个片段

**确认后继续：**
- ✅ 开始合并
- ✏️ 修改设置
- ❌ 返回
```

**完成后展示：**
```markdown
## 🎉 视频制作完成！

**最终视频：** [文件名].mp4

**文件位置：** ./out/video/[文件名].mp4

**统计信息：**
- 原始文案：[字数] 字
- 音频片段：[N] 个
- 视频片段：[N] 个
- 总时长：[X分Y秒]

**后续操作：**
- 📂 打开输出文件夹
- ▶️ 播放视频
- 🔄 使用相同设置制作新视频
- ✂️ 仅导出音频
```

## 目录结构规范

所有输出文件必须保存在 **Agent 当前工作目录** 下的 `out/` 文件夹中：

- `out/voice/[任务ID]/`：存放中间生成的音频
- `out/tmp/[任务ID]/`：存放中间生成的视频片段
- `out/video/`：存放最终合成的视频

**注意：** 不要将文件保存到 skills 目录中。

## 脚本调用示例

**语音生成：**
```bash
python @scripts/generate_voiceover_local.py --texts "段落1" "段落2" --ref_audio "路径" --emotion_ref_audio "路径" --output_dir "./out/voice/[任务ID]/" --api_url "API URL"
```

**视频生成：**
```bash
python @scripts/generate_avatar_video.py "照片路径" "音频路径" --output_dir "./out/tmp/[任务ID]/" --api_url "API URL" --aspect_ratio "9:16"
```

**视频合并：**
```bash
python @scripts/merge_videos.py --input_dir "./out/tmp/[任务ID]/" --output_file "./out/video/[任务ID]_[主题]_最终版.mp4"
```

## 对话框类型规范

### 选择类对话框
当用户需要从预定义选项中选择时：
```markdown
## [标题]

[说明性文字]

- ✅ [选项1] - [描述]
- 🔄 [选项2] - [描述]
- ❌ [选项3] - [描述]
```

### 输入类对话框
当用户需要输入自定义内容时：
```markdown
## [标题]

[说明性文字]

请输入：[_________]

或选择默认：[默认值] ✅

**选项：**
- ✅ 确认输入
- ❌ 取消
```

### 混合类对话框
同时包含选择和输入的对话框：
```markdown
## [标题]

[说明性文字]

**选项1（选择）：**
- [选项A]
- [选项B]

**选项2（输入）：**
请输入路径：_________

**全局选项：**
- ✅ 确认
- ❌ 取消
- 📂 浏览文件
```

### 进度展示对话框
展示长时间运行任务的进度：
```markdown
## [任务名称]

**[状态描述]**

**进度：** [██████░░░░] [已完成]/[总数]

**当前项：** [详细信息]

**已完成的项：**
- [项1] ✅
- [项2] ✅
- [项3] ⏳

**选项：**
- ⏸️ 暂停
- ❌ 取消
```
